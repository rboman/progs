CMAKE_MINIMUM_REQUIRED(VERSION 3.14)
PROJECT(SWIG_VECTOR CXX)

# send all binaries to ./bin
# SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin CACHE PATH "")
# SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin CACHE PATH  "")

FIND_PACKAGE(Python3 COMPONENTS Interpreter Development)

# -- Search for SWIG
FIND_PACKAGE(SWIG REQUIRED)
IF(CMAKE_GENERATOR MATCHES "Visual Studio") # not MSVC because of nmake & jom
    SET(CMAKE_SWIG_OUTDIR "${EXECUTABLE_OUTPUT_PATH}/$(Configuration)/")
ELSE()
    SET(CMAKE_SWIG_OUTDIR "${EXECUTABLE_OUTPUT_PATH}")
ENDIF()


# ----------- project


INCLUDE(${SWIG_USE_FILE})

FILE(GLOB SRCS *.h *.cpp)
FILE(GLOB ISRCS *.i)

SET_SOURCE_FILES_PROPERTIES(${ISRCS} PROPERTIES CPLUSPLUS ON)
SET(CMAKE_SWIG_FLAGS ${CMAKE_SWIG_FLAGS} "-interface" "_vec") # avoids "import _module_d" with MSVC/Debug
SWIG_ADD_LIBRARY(vec LANGUAGE python SOURCES ${ISRCS} ${SRCS})
SET_PROPERTY(TARGET vec PROPERTY SWIG_USE_TARGET_INCLUDE_DIRECTORIES ON)
TARGET_INCLUDE_DIRECTORIES(vec PRIVATE ${Python3_INCLUDE_DIRS} ${PROJECT_SOURCE_DIR})
TARGET_LINK_LIBRARIES(vec PRIVATE ${Python3_LIBRARIES})

