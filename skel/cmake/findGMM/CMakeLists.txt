CMAKE_MINIMUM_REQUIRED(VERSION 3.1)
PROJECT(GMMcode CXX)

# Use FindGMM.cmake
LIST(APPEND CMAKE_MODULE_PATH "${PROJECT_SOURCE_DIR}")
FIND_PACKAGE(GMM REQUIRED)

# compiler settings
IF(CMAKE_CXX_COMPILER_ID MATCHES "MSVC")
    ADD_DEFINITIONS(-D_CRT_SECURE_NO_WARNINGS -D_SCL_SECURE_NO_DEPRECATE)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /MP")  # parallel build with MSVC
ENDIF()

FILE(GLOB SRCS *.h *.cpp *.inl *.hpp)
ADD_EXECUTABLE(gmmcode ${SRCS})
TARGET_INCLUDE_DIRECTORIES(gmmcode PUBLIC ${GMM_INCLUDE_DIRS})
TARGET_COMPILE_DEFINITIONS(gmmcode PUBLIC ${GMM_DEFINITIONS})

ENABLE_TESTING()
ADD_TEST(NAME gmmcode COMMAND ${EXECUTABLE_OUTPUT_PATH}/gmmcode
         WORKING_DIRECTORY ${PROJECT_BINARY_DIR})
